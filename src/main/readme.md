# テスト駆動開発の練習

テスト駆動開発のサイクル

1. 小さなテストを1つ書く
2. 全てのテストを実行し、1つ失敗することを確認する
3. 小さな変更を行う
4. 再びテストを実行し、全て成功することを確認する
5. リファクタリングを行い、重複を除去する

テスト駆動開発の流れ  
1. テストを書く
2. 動かす
3. 正しくする

## 1章

現状  - レポートの内容  

| 銘柄  | 株数   | 価格  | 合計    |
|-----|------|-----|-------|
| IBM | 1000 | 25  | 25000 |
| GE  | 400  | 100 | 40000 |
総計 65000  

↓  

今後 - 通貨を追加したレポート  

| 銘柄  | 株数   | 価格      | 合計        |
|-----|------|---------|-----------|
| IBM | 1000 | 25 USD  | 25000 USD |
| GE  | 400  | 150 CHF | 60000 CHF |
総計 65000 USD  

為替レートも必要  

| 換算元 | 換算先   | レート     | 
|-----|------|---------|
| CHF | USD | 1.5  |

レポートを多国通貨に対応させる方法を検討していくことが課題  

## 1章の振り返り

書くべきテストのリストを作成
どうなれば嬉しいのかを小さいコードを使って確認
空実装を使ってコンパイラを通した
とにかくテストを通した
動くコードを徐々に共通かしてベタ書きの値を変数に置き換えた
TODOリストに項目を追加するにとどめて、一度に多くのものへ取り組むのをさけた

## 2章

Dollarの副作用の解消がテーマの章  

仮実装と明白な実装  
仮実装では、コードでまずベタ書きの値を使って、実装を進めるに従って徐々に変数に置き換える  
明白な実装では、すぐに頭の中の実装をコードに落とす  
→ これはTDDにおいて素早くグリーンにするための、2つの戦略

## 3章

Value Objectに関して  

人間界だと、ある整数に1を足すとき、元の整数が変更されるとは考えない  
新しい値が得られると考える  

一方、オブジェクトの振る舞いは異なり  
保険契約のオブジェクトがあるとして、契約条項に1つ条項を加えたら、元の保険契約の契約条項が変更される  

基本的にこのように変化し続けるオブジェクトを値として扱うこともできる=Value Objectパターン  

Value Objectにはコンストラクタで設定したインスタンス変数の値が変わってはならない  

Value Object を利用するメリットは別名参照(aliasing)を気にする必要がなくなること  

別名参照問題の例

小切手オブジェクトを作成、その金額を5ドルオブジェクトを示すDollarインスタンスを代入  
また別の小切手オブジェクトを作成し、同じDollarインスタンス(5ドル)を代入した場合を考える  

ある時、最初の小切手オブジェクトの金額(Dollar)の値を変更すると、意図せず2つ目の小切手の金額の値も変更される  
これを別名参照問題と呼ぶ  

Value Objectを利用すると 5ドルオブジェクトがあれば、永遠に5ドルのまま
7ドルを必要とする場合は、新しいオブジェクトを作る必要がある

## 3章の振り返り

value Object の使い方を理解できた

